
---
title: "Metro Melbourne COVID-19 2023 survey; Census 2016 & 2021 residential relocation"
runningheader: "Metro Melbourne COVID-19 2023 survey; Census 2016 & 2021 residential relocation" # only for pdf output
subtitle: "Data analysis" # only for html output
author: "Dr James Reynolds, Public Transport Research Group (PTRG), Monash University"
date: "`r Sys.Date()`"
output:
  tufte::tufte_html: 
    margin_references: false
    citation_package: natbib
  tufte::tufte_handout:
    citation_package: natbib
    latex_engine: xelatex
  tufte::tufte_book:
    citation_package: natbib
    latex_engine: xelatex
bibliography: skeleton.bib
link-citations: yes
---

```{r setup, include=FALSE}
library(tufte)
# invalidate cache when the tufte version changes
knitr::opts_chunk$set(cache.extra = packageVersion('tufte'))
options(htmltools.dir.version = FALSE)
```


# 1.0 Introduction
As part of the work program for the upcoming Metro Melbourne COVID-19 2023 (second) survey PTRG is comparing the usual place of residence results from the 2016 and 2021 Australian census. The analysis includes looking at Metro Melbourne as a whole, and also the inner, middle and outer regions individually, with those regions being as defined in the 2020 (first) survey. 

This work note summarises the analysis and findings. The next section discusses the datasets retrieved from the Australian Bureau of Statistics (ABS) Table Builder. Section 3 shows the regions used in the 2020 (first) survey and in this analysis. Section 4 presents the analysis results


# 2.0 Data 
Eight datasets were extracted as Comma-Separated Values (CSV) files using the ABS Table Builder online system. These were the results for the questions about usual place of residence 1 year ago and 5 years ago^[Specifically the Place of usual residence one year ago (PUR1P) and Place of usual residence five years ago (PUR5P) variables.  Details are avaiable at https://www.abs.gov.au/census/guide-census-data/census-dictionary/2021/variables-topic/location/place-usual-residence-one-year-ago-pur1p], with data retrieved for the 2016 and 2021 censuses. Separate tables were extracted for respondents who answered that their previous place of residence was within a specific Victorian LGA, and for those whose previous place of residence was in another state or territory. 

Some minor edits were made directly to the CSV files prior to importation into R^[The LGA name fields used for 2016 and 2021 were inconsistent. The 2016 version also showed the type of LGA, (Shire, Regional City or City) as letters (S, RC, C) in brackets. The 2021 CSV files were updated to adopt the 2016 approach.]. Examples of the data tables are shown below. 

```{r loadsurveydata, echo=FALSE, warning = FALSE, message = FALSE, include = TRUE} 
#Load datasets
library(readr)
X2016_1yr_ago_State <- read_csv("01 data/2016_1yr_ago_State.csv", skip = 8)
X2016_1yr_ago_Vic_LGA <- read_csv("01 data/2016_1yr_ago_Vic_LGA.csv", skip = 8)
X2016_5yr_ago_State <- read_csv("01 data/2016_5yr_ago_State.csv", skip = 8)
X2016_5yr_ago_Vic_LGA <- read_csv("01 data/2016_5yr_ago_Vic_LGA.csv", skip = 8)
X2021_1yr_ago_State <- read_csv("01 data/2021_1yr_ago_State.csv", skip = 9)
X2021_1yr_ago_Vic_LGA <- read_csv("01 data/2021_1yr_ago_Vic_LGA.csv", skip = 9)
X2021_5yr_ago_State <- read_csv("01 data/2021_5yr_ago_State.csv", skip = 9)
X2021_5yr_ago_Vic_LGA <- read_csv("01 data/2021_5yr_ago_Vic_LGA.csv", skip = 9)



#delete empty first rows from each table
X2016_1yr_ago_State <- X2016_1yr_ago_State[-1,]
X2016_1yr_ago_Vic_LGA <- X2016_1yr_ago_Vic_LGA[-1,]
X2016_5yr_ago_State <- X2016_5yr_ago_State[-1,]
X2016_5yr_ago_Vic_LGA <- X2016_5yr_ago_Vic_LGA[-1,]
X2021_1yr_ago_State <- X2021_1yr_ago_State[-1,]
X2021_1yr_ago_Vic_LGA <- X2021_1yr_ago_Vic_LGA[-1,]
X2021_5yr_ago_State <- X2021_5yr_ago_State[-1,]
X2021_5yr_ago_Vic_LGA <- X2021_5yr_ago_Vic_LGA[-1,]

#delete empty last column from each table
#delete total column from each table
#also delete Not Stated, and Not Applicable; from State tables
#also delete: Capital City Undefined (Greater Melbourne),	Unincorporated Vic,	No Usual Address (Vic.),	Migratory - Offshore - Shipping (Vic.), and	State Undefined (Vic.); from LGA tables
X2016_1yr_ago_State <- X2016_1yr_ago_State[,1:(ncol(X2016_1yr_ago_State)-4)]
X2016_1yr_ago_Vic_LGA <- X2016_1yr_ago_Vic_LGA[,1:(ncol(X2016_1yr_ago_Vic_LGA)-7)]
X2016_5yr_ago_State <- X2016_5yr_ago_State[,1:(ncol(X2016_5yr_ago_State)-4)]
X2016_5yr_ago_Vic_LGA <- X2016_5yr_ago_Vic_LGA[,1:(ncol(X2016_5yr_ago_Vic_LGA)-7)]
X2021_1yr_ago_State <- X2021_1yr_ago_State[,1:(ncol(X2021_1yr_ago_State)-3)]
X2021_1yr_ago_Vic_LGA <- X2021_1yr_ago_Vic_LGA[,1:(ncol(X2021_1yr_ago_Vic_LGA)-6)]
X2021_5yr_ago_State <- X2021_5yr_ago_State[,1:(ncol(X2021_5yr_ago_State)-3)]
X2021_5yr_ago_Vic_LGA <- X2021_5yr_ago_Vic_LGA[,1:(ncol(X2021_5yr_ago_Vic_LGA)-6)]

#delete last 3 to 4 rows from each table, as they contain ABS notes etc. 
#Also remove total row, 
#Also remove Unincorporated Vic, No usual address (Vic.) and 	Migratory - Offshore - Shipping (Vic.) rows as these are small and special cases that we do not need to include in this analysis 
X2016_1yr_ago_State <- head(X2016_1yr_ago_State,-8)
X2016_1yr_ago_Vic_LGA <- head(X2016_1yr_ago_Vic_LGA,-8)
X2016_5yr_ago_State <- head(X2016_5yr_ago_State,-8)
X2016_5yr_ago_Vic_LGA <- head(X2016_5yr_ago_Vic_LGA,-8)
X2021_1yr_ago_State <- head(X2021_1yr_ago_State,-11)
X2021_1yr_ago_Vic_LGA <- head(X2021_1yr_ago_Vic_LGA,-11)
X2021_5yr_ago_State <- head(X2021_5yr_ago_State,-11)
X2021_5yr_ago_Vic_LGA <- head(X2021_5yr_ago_Vic_LGA,-11)

#Convert second column to numeric, as it is a character for some reason
X2016_1yr_ago_State$`New South Wales` <- as.numeric(X2016_1yr_ago_State$`New South Wales`)
X2016_1yr_ago_Vic_LGA$`Alpine (S)` <- as.numeric(X2016_1yr_ago_Vic_LGA$`Alpine (S)`)
X2016_5yr_ago_State$`New South Wales` <- as.numeric(X2016_5yr_ago_State$`New South Wales`)
X2016_5yr_ago_Vic_LGA$`Alpine (S)` <- as.numeric(X2016_5yr_ago_Vic_LGA$`Alpine (S)`)
X2021_1yr_ago_State$`New South Wales` <- as.numeric(X2021_1yr_ago_State$`New South Wales`)
X2021_1yr_ago_Vic_LGA$`Alpine (S)` <- as.numeric(X2021_1yr_ago_Vic_LGA$`Alpine (S)`)
X2021_5yr_ago_State$`New South Wales` <- as.numeric(X2021_5yr_ago_State$`New South Wales`)
X2021_5yr_ago_Vic_LGA$`Alpine (S)` <- as.numeric(X2021_5yr_ago_Vic_LGA$`Alpine (S)`)

#change name of first column in all dataframes to LGA
df.list <- list(X2016_1yr_ago_State, X2016_1yr_ago_Vic_LGA, X2016_5yr_ago_State, X2016_5yr_ago_Vic_LGA, X2021_1yr_ago_State, X2021_1yr_ago_Vic_LGA, X2021_5yr_ago_State, X2021_5yr_ago_Vic_LGA)
res <- lapply(df.list, function(x) {colnames(x)[1] = "LGA"; x})
names(res) <- c("X2016_1yr_ago_State", "X2016_1yr_ago_Vic_LGA", "X2016_5yr_ago_State", "X2016_5yr_ago_Vic_LGA", "X2021_1yr_ago_State", "X2021_1yr_ago_Vic_LGA", "X2021_5yr_ago_State", "X2021_5yr_ago_Vic_LGA")
list2env(res,envir=.GlobalEnv)


knitr::kable(
  head(X2016_1yr_ago_State), format.args = list(big.mark = ",", scientific = FALSE), align = "lrrrrrrrrrr", caption = '2016 census, State/Territory of usual residence one year ago, results by LGA for Victoria, first 6 results')

knitr::kable(
  head(X2016_1yr_ago_Vic_LGA[,1:11]), format.args = list(big.mark = ",", scientific = FALSE), align = "lrrrrrrrrrr", caption = '2016 census, LGA of usual residence one year ago, results by LGA for Victoria, first 6 results')


```

Unfortunately, the place of usual residence 1 and 5 years ago variables from the ABS datasets includes people who did not move in the values shown for each LGA and State/Territory.  Hence it will be necessary to get the datasets for the Usual address one year ago indicator (UAI1P) and Usual address five years ago indicator (UAI5P)^[See details at https://www.abs.gov.au/census/guide-census-data/census-dictionary/2021/variables-topic/location/usual-address-one-year-ago-indicator-uai1p]

Some minor edits were made directly to the CSV files prior to importation into R^[Again, the LGA name fields used for 2016 and 2021 were inconsistent. The 2016 version also showed the type of LGA, (Shire, Regional City or City) as letters (S, RC, C) in brackets. The 2021 CSV files were updated to adopt the 2016 approach.]. Examples of the data tables are shown below. 


```{r load_place_indicator, echo=FALSE, warning = FALSE, message = FALSE, include = TRUE} 
#Load datasets
library(readr)
X2016_usual_address_1yr_ago_indicator <- read_csv("01 data/2016_usual_address_1yr_ago_indicator.csv", skip = 8)
X2016_usual_address_5yr_ago_indicator <- read_csv("01 data/2016_usual_address_5yr_ago_indicator.csv", skip = 8)
X2021_usual_address_1yr_ago_indicator <- read_csv("01 data/2021_usual_address_1yr_ago_indicator.csv", skip = 9)
X2021_usual_address_5yr_ago_indicator <- read_csv("01 data/2021_usual_address_5yr_ago_indicator.csv", skip = 9)



#delete empty first rows from each table
X2016_usual_address_1yr_ago_indicator <- X2016_usual_address_1yr_ago_indicator[-1,]
X2016_usual_address_5yr_ago_indicator <- X2016_usual_address_5yr_ago_indicator[-1,]
X2021_usual_address_1yr_ago_indicator <- X2021_usual_address_1yr_ago_indicator[-1,]
X2021_usual_address_5yr_ago_indicator <- X2021_usual_address_5yr_ago_indicator[-1,]

#delete empty last column from 2016 table
#delete total column from each table
X2016_usual_address_1yr_ago_indicator <- X2016_usual_address_1yr_ago_indicator[,1:(ncol(X2016_usual_address_1yr_ago_indicator)-2)]
X2016_usual_address_5yr_ago_indicator <- X2016_usual_address_5yr_ago_indicator[,1:(ncol(X2016_usual_address_5yr_ago_indicator)-2)]
X2021_usual_address_1yr_ago_indicator <- X2021_usual_address_1yr_ago_indicator[,1:(ncol(X2021_usual_address_1yr_ago_indicator)-1)]
X2021_usual_address_5yr_ago_indicator <- X2021_usual_address_5yr_ago_indicator[,1:(ncol(X2021_usual_address_5yr_ago_indicator)-1)]


#delete last 3 to 4 rows from each table, as they contain ABS notes etc. 
#Also remove total row, 
#Also remove Unincorporated Vic, No usual address (Vic.) and 	Migratory - Offshore - Shipping (Vic.) rows as these are small and special cases that we do not need to include in this analysis 
X2016_usual_address_1yr_ago_indicator <- head(X2016_usual_address_1yr_ago_indicator,-8)
X2016_usual_address_5yr_ago_indicator <- head(X2016_usual_address_5yr_ago_indicator,-8)
X2021_usual_address_1yr_ago_indicator <- head(X2021_usual_address_1yr_ago_indicator,-11)
X2021_usual_address_5yr_ago_indicator <- head(X2021_usual_address_5yr_ago_indicator,-11)

#Convert second column to numeric, as it is a character for some reason
X2016_usual_address_1yr_ago_indicator$`Same as in 2016` <- as.numeric(X2016_usual_address_1yr_ago_indicator$`Same as in 2016`)
X2016_usual_address_5yr_ago_indicator$`Same as in 2016` <- as.numeric(X2016_usual_address_5yr_ago_indicator$`Same as in 2016`)
X2021_usual_address_1yr_ago_indicator$`Same as in 2021` <- as.numeric(X2021_usual_address_1yr_ago_indicator$`Same as in 2021`)
X2021_usual_address_5yr_ago_indicator$`Same as in 2021` <- as.numeric(X2021_usual_address_5yr_ago_indicator$`Same as in 2021`)

#change name of first column in all dataframes to LGA
df.list <- list(X2016_usual_address_1yr_ago_indicator, X2016_usual_address_5yr_ago_indicator, X2021_usual_address_1yr_ago_indicator, X2021_usual_address_5yr_ago_indicator)
df.list <- lapply(df.list, function(x) {colnames(x)[1] = "LGA"; x})
names(df.list) <- c("X2016_usual_address_1yr_ago_indicator", "X2016_usual_address_5yr_ago_indicator", "X2021_usual_address_1yr_ago_indicator", "X2021_usual_address_5yr_ago_indicator")
list2env(df.list,envir=.GlobalEnv)


knitr::kable(
  head(X2016_usual_address_1yr_ago_indicator), format.args = list(big.mark = ",", scientific = FALSE), align = "lrrrrr", caption = '2016 census, Usual address one year ago, results by LGA for Victoria, first 6 results')

knitr::kable(
  head(X2021_usual_address_1yr_ago_indicator), format.args = list(big.mark = ",", scientific = FALSE), align = "lrrrrr", caption = '2021 census, Usual residence one year ago, results by LGA for Victoria, first 6 results')


```

Next, need to incorporate the 'same as in YYYY' into the by State and by LGA tables. 

```{r same_as_in_to_seperate_column, echo=FALSE, warning=FALSE, message=FALSE, include = TRUE} 

#Move State dataframes  in list
df.State.list <- list(X2016_1yr_ago_State, X2016_5yr_ago_State, X2021_1yr_ago_State,  X2021_5yr_ago_State)
names(df.State.list) <- c("X2016_1yr_ago_State", "X2016_5yr_ago_State", "X2021_1yr_ago_State", "X2021_5yr_ago_State")
#remove Victoria column from State dataframes list
df.State.list <- lapply(df.State.list, function(x) {x[-c(3)]})
#return State dataframes out of list
list2env(df.State.list,envir=.GlobalEnv)


#Move LGA dataframes  in list
df.LGA.list <- list(X2016_1yr_ago_Vic_LGA, X2016_5yr_ago_Vic_LGA, X2021_1yr_ago_Vic_LGA,  X2021_5yr_ago_Vic_LGA)
names(df.LGA.list) <- c("X2016_1yr_ago_Vic_LGA", "X2016_5yr_ago_Vic_LGA", "X2021_1yr_ago_Vic_LGA", "X2021_5yr_ago_Vic_LGA")


#Move usual address indicator dataframes  in list
df.usual_address.list <- list(X2016_usual_address_1yr_ago_indicator, X2016_usual_address_5yr_ago_indicator, X2021_usual_address_1yr_ago_indicator,  X2021_usual_address_5yr_ago_indicator)
names(df.LGA.list) <- c("X2016_usual_address_1yr_ago_indicator", "X2016_usual_address_5yr_ago_indicator", "X2021_usual_address_1yr_ago_indicator", "X2021_usual_address_5yr_ago_indicator")






#merge dataframes 2016 1 yr ago
X2016_combined_1yr_ago <- merge(X2016_usual_address_1yr_ago_indicator, X2016_1yr_ago_Vic_LGA, by.x = "LGA", by.y = "LGA")
X2016_combined_1yr_ago <- merge(X2016_combined_1yr_ago, X2016_1yr_ago_State, by.x = "LGA", by.y = "LGA")
#merge dataframes 2016 5 yr ago
X2016_combined_5yr_ago <- merge(X2016_usual_address_5yr_ago_indicator, X2016_5yr_ago_Vic_LGA, by.x = "LGA", by.y = "LGA")
X2016_combined_5yr_ago <- merge(X2016_combined_5yr_ago, X2016_5yr_ago_State, by.x = "LGA", by.y = "LGA")

#merge dataframes 2021 1 yr ago
X2021_combined_1yr_ago <- merge(X2021_usual_address_1yr_ago_indicator, X2021_1yr_ago_Vic_LGA, by.x = "LGA", by.y = "LGA")
X2021_combined_1yr_ago <- merge(X2021_combined_1yr_ago, X2021_1yr_ago_State, by.x = "LGA", by.y = "LGA")
#merge dataframes 2021 5 yr ago
X2021_combined_5yr_ago <- merge(X2021_usual_address_5yr_ago_indicator, X2021_5yr_ago_Vic_LGA, by.x = "LGA", by.y = "LGA")
X2021_combined_5yr_ago <- merge(X2021_combined_5yr_ago, X2021_5yr_ago_State, by.x = "LGA", by.y = "LGA")


#remove duplicated last (Overseas) columns from each dataframe
X2016_combined_1yr_ago <- X2016_combined_1yr_ago[,1:(ncol(X2016_combined_1yr_ago)-1)]
X2016_combined_5yr_ago <- X2016_combined_5yr_ago[,1:(ncol(X2016_combined_5yr_ago)-1)]
X2021_combined_1yr_ago <- X2021_combined_1yr_ago[,1:(ncol(X2021_combined_1yr_ago)-1)]
X2021_combined_5yr_ago <- X2021_combined_5yr_ago[,1:(ncol(X2021_combined_5yr_ago)-1)]


#write function to subtract the "Same as in YYYY" column from the relevant LGA column for each (LGA) row
function.subtract_same_as_in_YYYY_column <- function(df){
for (i in 1:nrow(df)){
    LGA_name <- df[i,1]
    same_location_number <- df[i,2]
    column_number_of_LGA_name <- which(colnames(df)==LGA_name)
df[i,column_number_of_LGA_name] <- df[i,column_number_of_LGA_name]-same_location_number
  }
return(df)}

#Move combined dataframes  into list
df.combined_by_LGA.list <- list(X2016_combined_1yr_ago, X2016_combined_5yr_ago, X2021_combined_1yr_ago,  X2021_combined_5yr_ago)
names(df.combined_by_LGA.list) <- c("X2016_combined_1yr_ago", "X2016_combined_5yr_ago", "X2021_combined_1yr_ago", "X2021_combined_5yr_ago")

#run function.subtract_same_as_in_YYYY_column on dataframes in the combined list
df.combined_by_LGA.list <- lapply(df.combined_by_LGA.list, function(x) {function.subtract_same_as_in_YYYY_column(x)})
names(df.combined_by_LGA.list) <- c("X2016_combined_1yr_ago", "X2016_combined_5yr_ago", "X2021_combined_1yr_ago", "X2021_combined_5yr_ago")

#push results of list back out to global environment
list2env(df.combined_by_LGA.list,envir=.GlobalEnv)


knitr::kable(
  head(X2016_combined_1yr_ago[,1:8]), format.args = list(big.mark = ",", scientific = FALSE), align = "lrrrrrrr", caption = '2016 census, combined table, first 6 results for first 8 columns')


```
  
# 3.0 Regions
Inner, middle and outer regions were defined in the 2020 Melbourne COVID-19 survey, as shown in the following table. The additional zones of Peri-Urban Area and Rest of Victoria have been defined in the work to date for the forthcoming Regional Victoria COVID-19 survey, and the following table also shows allocation of LGAs to those zones as well^[Note that the Peri-Urban Area and Rest of Victoria zones have actually been defined using the Statistical Area 3 (SA3) boundaries, which are different to LGA boundaries. However, LGA boundaries are such that LGAs can be, and have been, assigned to one of the Peri-Urban Area and Rest of Victoria zones.]. 

```{r loadregions, echo=FALSE, warning=FALSE, message=FALSE, include = TRUE} 
#Load dataset
library(readr)
region <- read_csv("01 data/region.csv")

knitr::kable(region, caption = 'Victorian LGAs by region')
```

# 4.0 Results 
Changes in residential location 1 and 5 years before the 2016 and 2021 censuses, by region, are shown in the following. 


```{r by_region_inner_middle_etc, echo=FALSE, warning=FALSE, message=FALSE, include = TRUE} 
#This section of code creates a list of dataframes with the complete details by region (inner, middle, outer, peri-urban, rest of vic, nsw, qld etc.)

#First join the dataframe of regions with each of the dataframes in the list of combined dataframes
df.combined_by_LGA.list <- lapply(df.combined_by_LGA.list, function(X) {merge(region, X)})
#return combined dataframes out of list
list2env(df.combined_by_LGA.list,envir=.GlobalEnv)

#Now obtain the position of inner, middle etc LGAs in the dataframes (ie row/column numbers)
LGAs_inner_position <- which(region$Region == "Inner")
LGAs_middle_position <- which(region$Region == "Middle")
LGAs_outer_position <- which(region$Region == "Outer")
LGAs_peri_urban_position <- which(region$Region == "Peri-Urban Area")
LGAs_rest_of_vic_position <- which(region$Region == "Rest of Victoria")


#Next collect all inner rows, and add them together
library(janitor)
df.inner.list <- lapply(df.combined_by_LGA.list, function(X) {
  X <- X[LGAs_inner_position,]})
df.inner.list <- lapply(df.inner.list, function(X) {
  X <- X %>% adorn_totals("row")})
df.inner.list <- lapply(df.inner.list, function(X) {
  X[[nrow(X),1]] <- "Inner"
  return(X)
  })


#Next collect all middle rows, and add them together
library(janitor)
df.middle.list <- lapply(df.combined_by_LGA.list, function(X) {
  X <- X[LGAs_middle_position,]})
df.middle.list <- lapply(df.middle.list, function(X) {
  X <- X %>% adorn_totals("row")})
df.middle.list <- lapply(df.middle.list, function(X) {
  X[[nrow(X),1]] <- "Middle"
  return(X)
  })


#Next collect all outer rows, and add them together
library(janitor)
df.outer.list <- lapply(df.combined_by_LGA.list, function(X) {
  X <- X[LGAs_outer_position,]})
df.outer.list <- lapply(df.outer.list, function(X) {
  X <- X %>% adorn_totals("row")})
df.outer.list <- lapply(df.outer.list, function(X) {
  X[[nrow(X),1]] <- "Outer"
  return(X)
  })


#Next collect all peri_urban rows, and add them together
library(janitor)
df.peri_urban.list <- lapply(df.combined_by_LGA.list, function(X) {
  X <- X[LGAs_peri_urban_position,]})
df.peri_urban.list <- lapply(df.peri_urban.list, function(X) {
  X <- X %>% adorn_totals("row")})
df.peri_urban.list <- lapply(df.peri_urban.list, function(X) {
  X[[nrow(X),1]] <- "Peri-Urban Areas"
  return(X)
  })


#Next collect all rest_of_vic rows, and add them together
library(janitor)
df.rest_of_vic.list <- lapply(df.combined_by_LGA.list, function(X) {
  X <- X[LGAs_rest_of_vic_position,]})
df.rest_of_vic.list <- lapply(df.rest_of_vic.list, function(X) {
  X <- X %>% adorn_totals("row")})
df.rest_of_vic.list <- lapply(df.rest_of_vic.list, function(X) {
  X[[nrow(X),1]] <- "Rest of Victoria"
  return(X)
  })


#Then collect the Inner, middle, outer etc totals from each list and combine into one list of dataframes
df.combined_by_region.list <- lapply(df.inner.list, tail, 1)
})

  
#####NEED COMBINE THE COLUMNS, THEN REWRITE SO IT CAN ALL BE APPLIED TO LISTS

#Make new list of dataframes for aggregated by region. 
df.combined_by_region.list <- lapply(df.combined_by_LGA.list, function(X){
  cbind(LGA = X[1], Region = X[2], NSW =X[87], QLD = X[88], SA = X[89], WA = X[90], TAS = X[91], NT = X[92], ACT = X[93], Other = X[94], Overseas = X[5], "Not stated" = X[6], "Not applicable" = X[7])
})






#STILL TO DO, AGREGATE LGA ROWS into INNER, MIDDLE, OUTER, PERi-URBAN, REST OF VICTORIA, and add to df.combined_by_region.list data frames



#Export back to Global Environment  
#names(df.combined_by_region.list) <- c("X2016_combined_1yr_ago", "X2016_combined_5yr_ago", "X2021_combined_1yr_ago", "X2021_combined_5yr_ago")
#list2env(df.combined_by_region.list,envir=.GlobalEnv)

```





```{r by_region, echo=FALSE, warning=FALSE, message=FALSE, include = TRUE} 
#Join dataframe of regions with each of the dataframes in the list of combined dataframes
df.combined_by_LGA.list <- lapply(df.combined_by_LGA.list, function(X) {merge(region, X)})
#return combined dataframes out of list
list2env(df.combined_by_LGA.list,envir=.GlobalEnv)

#Obtain position of inner, middle etc LGAs in the dataframes
LGAs_inner_position <- which(region$Region == "Inner")
LGAs_middle_position <- which(region$Region == "Middle")
LGAs_outer_position <- which(region$Region == "Outer")
LGAs_peri_urban_position <- which(region$Region == "Peri-Urban Area")
LGAs_rest_of_vic_position <- which(region$Region == "Rest of Victoria")


#Collect all inner rows, then add them together
X2016_combined_1yr_ago_inner <- X2016_combined_1yr_ago[LGAs_inner_position,]
library(janitor)
X2016_combined_1yr_ago_inner <- X2016_combined_1yr_ago_inner %>% adorn_totals("row")
X2016_combined_1yr_ago_inner[nrow(X2016_combined_1yr_ago_inner),1] <- "Inner"

#Collect all middle rows, then add them together
X2016_combined_1yr_ago_middle <- X2016_combined_1yr_ago[LGAs_middle_position,]
library(janitor)
X2016_combined_1yr_ago_middle <- X2016_combined_1yr_ago_middle %>% adorn_totals("row")
X2016_combined_1yr_ago_middle[nrow(X2016_combined_1yr_ago_middle),1] <- "Middle"

#Collect all outer rows, then add them together
X2016_combined_1yr_ago_outer <- X2016_combined_1yr_ago[LGAs_outer_position,]
library(janitor)
X2016_combined_1yr_ago_outer <- X2016_combined_1yr_ago_outer %>% adorn_totals("row")
X2016_combined_1yr_ago_outer[nrow(X2016_combined_1yr_ago_outer),1] <- "Outer"


#Collect all peri-urban rows, then add them together
X2016_combined_1yr_ago_peri_urban <- X2016_combined_1yr_ago[LGAs_peri_urban_position,]
library(janitor)
X2016_combined_1yr_ago_peri_urban <- X2016_combined_1yr_ago_peri_urban %>% adorn_totals("row")
X2016_combined_1yr_ago_peri_urban[nrow(X2016_combined_1yr_ago_peri_urban),1] <- "Peri-Urban Area"


#Collect all rest_of_vic rows, then add them together
X2016_combined_1yr_ago_rest_of_vic <- X2016_combined_1yr_ago[LGAs_rest_of_vic_position,]
library(janitor)
X2016_combined_1yr_ago_rest_of_vic <- X2016_combined_1yr_ago_rest_of_vic %>% adorn_totals("row")
X2016_combined_1yr_ago_rest_of_vic[nrow(X2016_combined_1yr_ago_rest_of_vic),1] <- "Rest of Victoria"


#####NEED COMBINE THE COLUMNS, THEN REWRITE SO IT CAN ALL BE APPLIED TO LISTS

#Make new list of dataframes for aggregated by region. 
df.combined_by_region.list <- lapply(df.combined_by_LGA.list, function(X){
  cbind(LGA = X[1], Region = X[2], NSW =X[87], QLD = X[88], SA = X[89], WA = X[90], TAS = X[91], NT = X[92], ACT = X[93], Other = X[94], Overseas = X[5], "Not stated" = X[6], "Not applicable" = X[7])
})






#STILL TO DO, AGREGATE LGA ROWS into INNER, MIDDLE, OUTER, PERi-URBAN, REST OF VICTORIA, and add to df.combined_by_region.list data frames



#Export back to Global Environment  
#names(df.combined_by_region.list) <- c("X2016_combined_1yr_ago", "X2016_combined_5yr_ago", "X2021_combined_1yr_ago", "X2021_combined_5yr_ago")
#list2env(df.combined_by_region.list,envir=.GlobalEnv)

```